<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MarktCheck</title>
  <link rel="stylesheet" href="style.css">

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#5b2bd1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MarktCheck">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">

</head>
<body>
<script>
  // Zugriffsschutz (offline / Frontend-only)
  if (localStorage.getItem("marktcheck.auth") !== "1") {
    window.location.href = "index.html";
  }
</script>

<div class="container">
  <div class="header" style="position:sticky">
<div class="titleRow">
      <h1 class="title sellenceTitle"><span class="sellenceBrand">SELLENCE</span><span class="sellenceSub">MarktCheck</span></h1>
    </div>
    <div class="sub" id="datetime">‚Äî</div>
  </div>

  <div class="card" id="productCard" aria-live="polite">
    <div class="card-head">
      <b id="sectionName">‚Äî</b>
      <select id="jumpSelect" class="jumpSelect" aria-label="Sprung zu Kategorie"></select>
      <span id="sectionCount">‚Äî</span>
    </div>

    <div class="product">
      <div class="nameTop" id="name">‚Äî</div>

      <div class="imgBox">
        <div class="fallback" id="imgFallback">Kein Bild</div>
        <img id="img" alt="" style="display:none" />
      </div>

      <div class="price" id="price">Preis: ‚Äî</div>
      <div class="content" id="content">Inhalt: ‚Äî</div>

      <div class="actions">
        <button class="btn no" id="btnNo">‚ùå Nicht da</button>
        <button class="btn ok" id="btnOk">‚úÖ Da</button>
      </div>

    </div>
  </div>

  <div class="summary" id="summary">
    <div class="printHeader">
      <img src="assets/logo-sellence.png" alt="SELLENCE" />
    </div>
    <h2 style="margin:0 0 10px;font-size:18px">Ergebnis</h2>

    <div class="field">
      <label>Marktname</label>
      <input id="marketName" placeholder="z.B. EDEKA Musterstadt" />
    </div>

    <div class="field">
      <label>Erstellt von</label>
      <input id="createdBy" placeholder="z.B. Andre Schorn" />
    </div>

    <div class="field">
      <label>Datum & Uhrzeit</label>
      <input id="stamp" readonly />
    </div>

    <div class="toggleRow">
      <div>
        <div class="tTitle">Export-Filter</div>
        <div class="tSub">Nur ‚ÄûNICHT DA‚Äú in der PDF anzeigen</div>
      </div>
      <input id="onlyMissing" type="checkbox" checked />
    </div>

    <div class="actions" style="margin-top:0">
      <button class="miniBtn" id="btnBack">‚¨ÖÔ∏è Zur√ºck</button>
      <button class="miniBtn" id="btnReset">‚ôªÔ∏è Reset</button>
      <button class="miniBtn primary" id="btnPrint">üñ®Ô∏è PDF</button>
    </div>
    <div class="toast" id="toast"></div>

    <div class="tableWrap" style="margin-top:12px">
      <table id="resultTable">
        <thead>
          <tr>
            <th>Bereich</th><th>Produkt</th><th>Preis</th><th>Inhalt</th><th>Status</th><th class="action-col">Aktion</th><th class="ean-col">Gebinde EAN</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="hint" style="margin-top:10px">
      Tipp: Du kannst im Ergebnis einzelne Produkte per Button nachtr√§glich auf ‚ÄûDA‚Äú/‚ÄûNICHT DA‚Äú setzen.
    </div>
  </div>
</div>

<div class="footer" id="footerBar">
  <div class="footer-inner">
    <div class="sub" id="progressText" style="margin:0">Bereit</div>
    <div class="pill pill-status" id="footerStatusPill" style="margin:0;justify-content:center">
      <span class="badge ok">‚úÖ DA <b id="countOk">0</b></span>
      <span class="badge no">‚ùå NICHT DA <b id="countNo">0</b></span>
    </div>
    <button class="miniBtn primary" id="btnSkip">Zum Export</button>
  </div>
</div>

<script>
  const data = [
  // =======================
  // IQOS / TEREA
  // =======================
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMA Kit Pebble Beige", price:null, content:"1 St√ºck", img:"assets/iqos/1045460-iqos-iluma-one-pebble-beige.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMA Kit Pebble Grey", price:null, content:"1 St√ºck", img:"assets/iqos/1045459-iqos-iluma-one-pebble-grey.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMAi Kit Breeze Blue", price:null, content:"1 St√ºck", img:"assets/iqos/1111589-iqos-iluma-i-kit-breeze-blue-regis-neu.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMAi ONE Kit Midnight Black", price:null, content:"1 St√ºck", img:"assets/iqos/1111595-iqos-iluma-i-kit-midnight-black-regis-neu.png"},
  {section:"IQOS", brand:"IQOS", name:"IQOS ILUMAi ONE Kit Vivid Terracotta", price:null, content:"1 St√ºck", img:"assets/iqos/1111607-iqos-iluma-i-one-vivid-terracotta-regis-neu.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Amber Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108971-terea-tabaksticks-amber-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Bronze Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108702-terea-tabaksticks-bronze-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Russet Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108295-terea-tabaksticks-russet-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Sienna Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108708-terea-tabaksticks-sienna-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Silver Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1109372-terea-tabaksticks-silver-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Teak Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108644-terea-tabaksticks-teak-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Turquoise Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108701-terea-tabaksticks-turquoise-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Warm Fuse Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108277-terea-tabaksticks-warm-fuse-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Yellow Green Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108703-terea-tabaksticks-yellow-green-pack.png"},
  {section:"IQOS", brand:"TEREA", name:"TEREA Yellow Selection", price:7.5, content:"20 St√ºck", img:"assets/terea/1108987-terea-tabaksticks-yellow-pack.png"},

  // =======================
  // VEEV
  // =======================
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Blue Raspberry", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Blue_Raspberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Classic Mint", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Classic_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Grape", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Grape.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Mango", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Mango.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Passion Fruit Kiwi Guava", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Passion_Fruit_Kiwi_Guava.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Sour Apple", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Sour_Apple.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Strawberry", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Strawberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV NOW ULTRA Watermelon", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_NOW_ULTRA_Watermelon.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Kit Velvet Black", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_One_Kit_Velvet_Black.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Kit Silky Grey", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_One_Kit_Silky_Grey.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Kit Freshy Green", price:9.9, content:"1 St√ºck", img:"assets/veev/VEEV_One_Kit_Freshy_Green.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Balanced Tobacco", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Balanced_Tobacco.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Blue Mint", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Blue_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Blue Raspberry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Blue_Raspberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Blueberry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Blueberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Classic Tobacco", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Classic_Tobacco.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Green Mint", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Green_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Ice Mint", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Ice_Mint.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Mango", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Mango.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Peach", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Peach.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Sour Apple", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Sour_Apple.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Strawberry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Strawberry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Watermelon", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Watermelon.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Cherry", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Cherry.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Grape", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Grape.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Passion Fruit Kiwi Guava", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Passion_Fruit_Kiwi_Guava.png"},
  {section:"VEEV", brand:"VEEV", name:"VEEV One Pods Red Berries", price:9.9, content:"2 St√ºck", img:"assets/veev/VEEV_One_Pods_Red_Berries.png"},

  // =======================
  // Zigaretten + Cigarillos (nach Marke, Preis aufsteigend)
  // =======================
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue King Size Filter Cigarillos OP Box", price:3, content:"17 St√ºck", img:"assets/chesterfield/1110813-chesterfield-op-blue-zigaretten-einzel.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Red King Size Filter Cigarillos OP Box", price:3, content:"17 St√ºck", img:"assets/chesterfield/1107630-chesterfield-unplugged-red-pouch-tabak.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP Box", price:8.6, content:"20 St√ºck", img:"assets/chesterfield/1110813-chesterfield-op-blue-zigaretten-einzel.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Original OP-Box", price:8.6, content:"20 St√ºck", img:"assets/chesterfield/1111367-chesterfield-op-original-zigaretten-einzel.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP XL-Box", price:10, content:"25 St√ºck", img:"assets/chesterfield/1110813-chesterfield-op-blue-zigaretten-einzel.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Original OP XL-Box", price:10, content:"25 St√ºck", img:"assets/chesterfield/1111367-chesterfield-op-original-zigaretten-einzel.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/chesterfield/1113935-chesterfield-blue-zigaretten-2xl.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Original OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/chesterfield/1111760-chesterfield-2xl-original-zigaretten.png"},
  {section:"Zigaretten", brand:"Chesterfield", name:"Chesterfield Blue OP 4XL-Box", price:15, content:"39 St√ºck", img:"assets/chesterfield/1113935-chesterfield-blue-zigaretten-2xl.png"},
  {section:"Zigaretten", brand:"f6", name:"F6 Original OP-Box", price:8.6, content:"20 St√ºck", img:"assets/other/1109946-f6-zigaretten-original.png"},
  {section:"Zigaretten", brand:"f6", name:"f6 Blue OP XL-Box", price:10, content:"25 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
  {section:"Zigaretten", brand:"f6", name:"F6 Original OP XL-Box", price:10, content:"25 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
  {section:"Zigaretten", brand:"f6", name:"F6 Original OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/other/1111626-f6-zigaretten-original-2xl.png"},
  {section:"Zigaretten", brand:"f6", name:"f6 Blue OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
  {section:"Zigaretten", brand:"f6", name:"f6 Original OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/other/1109303-f6-zigaretten-original-xl.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Filter Cigarillos Blue Label OP Box", price:3, content:"17 St√ºck", img:"assets/lm/1107592-l-m-dose-rot-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Filter Cigarillos Redlabel OP Box", price:3, content:"17 St√ºck", img:"assets/lm/1107592-l-m-dose-rot-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Blue Label OP-Box", price:8.6, content:"20 St√ºck", img:"assets/lm/1107592-l-m-dose-rot-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label LONG OP-Box", price:8.6, content:"20 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP-Box", price:8.6, content:"20 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Simply Blue OP-Box", price:8.6, content:"20 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Simply Red OP-Box", price:8.6, content:"20 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Blue Label OP XL-Box", price:10, content:"25 St√ºck", img:"assets/lm/1107592-l-m-dose-rot-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP XL-Box", price:10, content:"25 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Blue Label OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 2XL-Box", price:12, content:"31 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Blue Label OP 4XL-Box", price:15, content:"39 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 4XL-Box", price:15, content:"39 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Blue Label OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/lm/1109516-l-m-blau-2XL-Zigaretten.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 7XL-Box", price:21, content:"60 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Zigaretten", brand:"L&M", name:"L&M Red Label OP 9XL-Box", price:28, content:"80 St√ºck", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Gold OP-Box", price:8, content:"20 St√ºck", img:"assets/marlboro/1112018-malboro-crafted-gold-zigaretten-op.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Red OP-Box", price:8, content:"20 St√ºck", img:"assets/marlboro/1112014-malboro-crafted-red-zigaretten-op.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109513-marlboro-gold-long-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold Soft Label OP Soft", price:9, content:"20 St√ºck", img:"assets/marlboro/1109513-marlboro-gold-long-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Mix OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109634-malboro-mix-op-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red Soft Label OP Soft", price:9, content:"20 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Silver Blue OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109488-malboro-gold-zigaretten-xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Simply Blue OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109488-malboro-gold-zigaretten-xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Simply Red OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro White OP-Box", price:9, content:"20 St√ºck", img:"assets/marlboro/1109488-malboro-gold-zigaretten-xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold LONG OP-Box", price:9.1, content:"20 St√ºck", img:"assets/marlboro/1109488-malboro-gold-zigaretten-xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red LONG OP-Box", price:9.1, content:"20 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Gold OP 2XL-Box", price:10, content:"27 St√ºck", img:"assets/marlboro/1112020-malboro-crafted-gold-zigaretten-2xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Red OP 2XL-Box", price:10, content:"27 St√ºck", img:"assets/marlboro/1112016-malboro-crafted-red-zigaretten-2xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP XL-Box", price:10, content:"23 St√ºck", img:"assets/marlboro/1109488-malboro-gold-zigaretten-xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Mix OP XL-Box", price:10, content:"23 St√ºck", img:"assets/marlboro/1109406-malboro-mix-xl-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP XL-Box", price:10, content:"23 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP 2XL-Box", price:12, content:"29 St√ºck", img:"assets/marlboro/1112020-malboro-crafted-gold-zigaretten-2xl.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Mix OP 2XL-Box", price:12, content:"29 St√ºck", img:"assets/marlboro/1109634-malboro-mix-op-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 2XL-Box", price:12, content:"29 St√ºck", img:"assets/marlboro/1109783-malboro-red-2xl-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP 4XL-Box", price:15, content:"36 St√ºck", img:"assets/marlboro/1109662-malboro-gold-4xl-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 4XL-Box", price:15, content:"36 St√ºck", img:"assets/marlboro/1109876-malboro-red-4xl-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Gold OP 7XL-Box", price:20, content:"60 St√ºck", img:"assets/marlboro/1113475-malboro-gold-crafted-7xl-zigaretten-schachtel.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Crafted Red OP 7XL-Box", price:20, content:"60 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Gold OP 7XL-Box", price:20, content:"52 St√ºck", img:"assets/marlboro/1109513-marlboro-gold-long-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 7XL-Box", price:20, content:"52 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Marlboro", name:"Marlboro Red OP 9XL-Box", price:30, content:"80 St√ºck", img:"assets/marlboro/1109417-marlboro-7xl-red-zigaretten.png"},
  {section:"Zigaretten", brand:"Other", name:"Parliament Night Blue LONG OP-Box", price:9, content:"20 St√ºck", img:"assets/other/1109946-f6-zigaretten-original.png"},
  {section:"Zigaretten", brand:"Other", name:"EVE 120 OP-Box", price:9.3, content:"20 St√ºck", img:"assets/other/1109946-f6-zigaretten-original.png"},

  // =======================
  // Tabak (Beutel/Dose/Box nach Marke, Preis aufsteigend)
  // =======================
  {section:"Tabak", brand:"Chesterfield", name:"Chesterfield Unplugged Red", price:7.2, content:"30g", img:"assets/chesterfield/1107630-chesterfield-unplugged-red-pouch-tabak.png"},
  {section:"Tabak", brand:"Chesterfield", name:"Chesterfield Volume Tobacco Red M", price:9.95, content:"40g", img:"assets/chesterfield/1103183-Chesterfield-Dose-M-Tabak.png"},
  {section:"Tabak", brand:"Chesterfield", name:"Chesterfield Volume Tobacco Red Mega", price:29.95, content:"135g", img:"assets/chesterfield/1108755-chesterfield-red-mega-box-volumentabak.png"},
  {section:"Tabak", brand:"Chesterfield", name:"Chesterfield Volume Tobacco Red Giga", price:49.95, content:"255g", img:"assets/chesterfield/1107630-chesterfield-unplugged-red-pouch-tabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Cigarette Tobacco Red", price:7.4, content:"30g", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Volume Tobacco Blue M", price:12.65, content:"39g", img:"assets/lm/1107592-l-m-dose-rot-volumentabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Volume Tobacco Red M", price:12.65, content:"39g", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Volume Tobacco Red L", price:19.95, content:"65g", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Volume Tobacco Red", price:24.95, content:"85g", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Volume Tobacco Red Big", price:34.95, content:"129g", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Tabak", brand:"L&M", name:"L&M Volume Tobacco Red Mega", price:49.95, content:"185g", img:"assets/lm/1108129-lm-red-m-dose-volumentabak.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Gold", price:7.5, content:"30g", img:"assets/ean/marlboro_tabak/marlboro-premium-tobacco-gold.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Red", price:7.5, content:"30g", img:"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Zware", price:10, content:"50g", img:"assets/ean/marlboro_tabak/marlboro-premium-tobacco-zware.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Gold M", price:19, content:"70g", img:"assets/marlboro_tabak/1106713-Marlboro-Gold-Tabak-Pouch.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Red M", price:19, content:"70g", img:"assets/marlboro_tabak/1107585-marlboro-red-rot-premium-feinschnitt-xxl-tabak-dose.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Red L", price:24.95, content:"103g", img:"assets/marlboro_tabak/1107301-marlboro-rot-tabak-l-dose.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Premium Tobacco Red XL", price:36.95, content:"155g", img:"assets/marlboro_tabak/1107585-marlboro-red-rot-premium-feinschnitt-xxl-tabak-dose.png"},
  {section:"Tabak", brand:"Marlboro", name:"Marlboro Crafted Mega", price:49.95, content:"230g", img:"assets/ean/marlboro_tabak/Marlboro Crafted Box 230g Mega.png"},
  {section:"Tabak", brand:"Pielroja", name:"Pielroja Rolling Tobacco", price:6, content:"30g", img:"assets/other/1104598-pielroja-drehtabak.png"},
];

  const KEY = "marktcheck.answers.unified.v1";
  let answers = JSON.parse(localStorage.getItem(KEY) || "[]");
  if(!Array.isArray(answers) || answers.length !== data.length){
    answers = data.map(_ => ({status:null}));
    localStorage.setItem(KEY, JSON.stringify(answers));
  }
  let i = 0;

  const elDT = document.getElementById("datetime");
  const elStatusPill = document.getElementById("statusPill");
  const elCountOk = document.getElementById("countOk");
  const elCountNo = document.getElementById("countNo");
  const elProg = document.getElementById("progressText");

  const elSection = document.getElementById("sectionName");
  const elSectionCount = document.getElementById("sectionCount");
  const elJump = document.getElementById("jumpSelect");

  const elName = document.getElementById("name");
  const elPrice = document.getElementById("price");
  const elContent = document.getElementById("content");

  const elImg = document.getElementById("img");
  const elImgFallback = document.getElementById("imgFallback");

  const card = document.getElementById("productCard");
  const summary = document.getElementById("summary");
  const footerBar = document.getElementById("footerBar");

  const btnOk = document.getElementById("btnOk");
  const btnNo = document.getElementById("btnNo");
  const btnExport = document.getElementById("btnSkip"); // Button unten rechts (UI: "Zum Export")

  const btnBack = document.getElementById("btnBack");
  const btnReset = document.getElementById("btnReset");
  const btnPrint = document.getElementById("btnPrint");
const stamp = document.getElementById("stamp");
  const onlyMissing = document.getElementById("onlyMissing");
  const toast = document.getElementById("toast");
  const resultTable = document.getElementById("resultTable");

  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = "block";
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.style.display="none", 2200);
  }

  function pad(n){ return String(n).padStart(2,"0"); }
  function formatDT(d){ return `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`; }
  const now = new Date();
  elDT.textContent = formatDT(now);
  stamp.value = formatDT(now);

  function euro(x){ if(x==null) return "‚Äî"; return x.toFixed(2).replace(".",",")+" ‚Ç¨"; }

  // Kategorien (nur 5 Stk.)
  function categoryOf(p){
    if(p.section === "Zigaretten") return "Zigaretten";
    if(p.section === "Tabak") return "Tabak";
    if(p.section === "VEEV") return "VEEV";
    if(p.section === "IQOS" && p.brand === "TEREA") return "TEREA";
    if(p.section === "IQOS") return "IQOS-Ger√§te";
    return p.section;
  }

  function categoryStats(cat){
    const idx = [];
    for(let k=0;k<data.length;k++){
      if(categoryOf(data[k]) === cat) idx.push(k);
    }
    const done = idx.filter(k=>answers[k].status!==null).length;
    return {done, total: idx.length};
  }

  // Sprung-Navigation (Kategorien)
  function buildJumpOptions(){
    if(!elJump) return;

    const cats = ["Zigaretten","Tabak","TEREA","IQOS-Ger√§te","VEEV"];
    elJump.innerHTML = "";

    const ph = document.createElement("option");
    ph.value = "";
    ph.textContent = "Kategorie w√§hlen‚Ä¶";
    ph.disabled = true;
    elJump.appendChild(ph);

    cats.forEach(cat=>{
      const st = categoryStats(cat);
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = `${cat} (${st.done}/${st.total})`;
      elJump.appendChild(opt);
    });

    // initialer Wert: aktuelle Kategorie
    try { elJump.value = categoryOf(data[i]); } catch(e){ elJump.value=""; }
  }

  function jumpToCategory(cat){
    const candidates = [];
    for(let idx=0; idx<data.length; idx++){
      if(categoryOf(data[idx]) === cat) candidates.push(idx);
    }
    if(!candidates.length) return;

    const openIdx = candidates.find(idx => answers[idx].status === null);
    i = (openIdx != null) ? openIdx : candidates[0];

    if(summary.style.display === "block"){
      summary.style.display="none";
      card.style.display="block";
      footerBar.style.display="block";
    }
    showProduct();
  }

function updateHeader(){
    const done = answers.filter(r=>r.status!==null).length;
    const ok = answers.filter(r=>r.status===true).length;
    const no = answers.filter(r=>r.status===false).length;

    // Status oben rechts (DA / NICHT DA)
    if(elCountOk) elCountOk.textContent = ok;
    if(elCountNo) elCountNo.textContent = no;
    if(elStatusPill && !elCountOk && !elCountNo){
      elStatusPill.textContent = `DA: ${ok} ‚Ä¢ NICHT DA: ${no}`;
    }

    // Fortschritt unten in der Footer-Bar (statt im Titel)
    if(elProg){
      if(done < data.length){
        elProg.textContent = `Fortschritt ${done}/${data.length}`;
      } else {
        elProg.textContent = `Fertig ¬∑ ${data.length}/${data.length}`;
      }
    }
  }

  function setImage(path, alt){
    elImg.style.display="none";
    elImgFallback.style.display="block";
    elImgFallback.textContent="Kein Bild";
    elImg.removeAttribute("src");
    if(!path) return;

    const test = new Image();
    test.onload = ()=>{
      elImg.src = path;
      elImg.alt = alt || "";
      elImg.style.display = "block";
      elImgFallback.style.display = "none";
    };
    test.onerror = ()=>{ elImgFallback.textContent = `Bild nicht gefunden: ${path}`; };
    test.src = path;
  }

  function showProduct(){
    if(i >= data.length) return showSummary();
    const p = data[i];
    const cat = categoryOf(p);
    const st = categoryStats(cat);

    elSection.textContent = cat;
    elSectionCount.textContent = `${st.done}/${st.total}`;

    // Dropdown aktuell halten (inkl. Fortschritt in den Labels)
    if(elJump){
      buildJumpOptions();
      elJump.value = cat;
    }

    elName.textContent = p.name;
    elPrice.textContent = `Preis: ${euro(p.price)}`;
    elContent.textContent = `Inhalt: ${(p.content && String(p.content).trim()) ? p.content : "‚Äî"}`;

    setImage(p.img, p.name);
    updateHeader();
  }

  function mark(status){
    answers[i].status = status;
    localStorage.setItem(KEY, JSON.stringify(answers));
    i++;
    showProduct();
  }


  // --- EAN Barcode (nur f√ºr PDF/Print sichtbar) ---
  function slugify(str){
    return String(str || "")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"") // accents
      .replace(/√§/g,"ae").replace(/√∂/g,"oe").replace(/√º/g,"ue").replace(/√ü/g,"ss")
      .replace(/[^a-z0-9]+/g,"-")
      .replace(/-+/g,"-")
      .replace(/^-|-$/g,"");
  }

    const EAN_FILE_MAP = {
  "chesterfieldbluekingsizefiltercigarillosopbox":"assets/ean/chesterfield/chesterfield-blue-king-size-filter-cigarillos-op-box.png",
  "chesterfieldbluekingsizefiltercigarillosopboxpack17stk":"assets/ean/chesterfield/Chesterfield Blue King Size Filter Cigarillos OP Box Pack 17 Stk Gebinde.png",
  "chesterfieldbluekingsizefiltercigarillosopboxpack17stkgebinde":"assets/ean/chesterfield/Chesterfield Blue King Size Filter Cigarillos OP Box Pack 17 Stk Gebinde.png",
  "chesterfieldblueop2xlbox":"assets/ean/chesterfield/chesterfield-blue-op-2xl-box.png",
  "chesterfieldblueopbox":"assets/ean/chesterfield/chesterfield-blue-op-box.png",
  "chesterfieldblueopxlbox":"assets/ean/chesterfield/chesterfield-blue-op-xl-box.png",
  "chesterfieldoriginalop2xlbox":"assets/ean/chesterfield/chesterfield-original-op-2xl-box.png",
  "chesterfieldoriginalopbox":"assets/ean/chesterfield/chesterfield-original-op-box.png",
  "chesterfieldoriginalopxlbox":"assets/ean/chesterfield/chesterfield-original-op-xl-box.png",
  "chesterfieldredkingsizefiltercigarillosopbox":"assets/ean/chesterfield/chesterfield-red-king-size-filter-cigarillos-op-box.png",
  "chesterfieldredkingsizefiltercigarillosopboxpack17stk":"assets/ean/chesterfield/Chesterfield Red King Size Filter Cigarillos OP Box Pack 17 Stk Gebinde.png",
  "chesterfieldredkingsizefiltercigarillosopboxpack17stkgebinde":"assets/ean/chesterfield/Chesterfield Red King Size Filter Cigarillos OP Box Pack 17 Stk Gebinde.png",
  "chesterfieldunpluggedred":"assets/ean/chesterfield/chesterfield-unplugged-red.png",
  "chesterfieldunpluggedredpouch30g":"assets/ean/chesterfield/Chesterfield Unplugged Red Pouch 30g Gebinde.png",
  "chesterfieldunpluggedredpouch30ggebinde":"assets/ean/chesterfield/Chesterfield Unplugged Red Pouch 30g Gebinde.png",
  "chesterfieldvolumetobaccoredbox135gmega":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Box 135g Mega.png",
  "chesterfieldvolumetobaccoredbox255ggiga":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Box 255g Giga.png",
  "chesterfieldvolumetobaccoreddose40gm":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Dose 40g M Gebinde.png",
  "chesterfieldvolumetobaccoreddose40gmgebinde":"assets/ean/chesterfield/Chesterfield Volume Tobacco Red Dose 40g M Gebinde.png",
  "chesterfieldvolumetobaccoredgiga":"assets/ean/chesterfield/chesterfield-volume-tobacco-red-giga.png",
  "chesterfieldvolumetobaccoredm":"assets/ean/chesterfield/chesterfield-volume-tobacco-red-m.png",
  "chesterfieldvolumetobaccoredmega":"assets/ean/chesterfield/chesterfield-volume-tobacco-red-mega.png",
  "chesterfieldzigarettenblue5x39er":"assets/ean/chesterfield/Chesterfield Zigaretten Blue (5x39er).png",
  "chesterfieldzigarettenblue8x25er":"assets/ean/chesterfield/Chesterfield Zigaretten Blue (8x25er).png",
  "chesterfieldzigarettenblue8x31er":"assets/ean/chesterfield/Chesterfield Zigaretten Blue (8x31er).png",
  "chesterfieldzigarettenoriginal8x25er":"assets/ean/chesterfield/Chesterfield Zigaretten Original (8x25er).png",
  "chesterfieldzigarettenoriginal8x31er":"assets/ean/chesterfield/Chesterfield Zigaretten Original (8x31er).png",
  "evezigaretten12010x20er":"assets/ean/other/Eve Zigaretten 120 (10x20er).png",
  "iqosilumaikitbreezeblue":"assets/ean/iqos/iqos-ilumai-kit-breeze-blue.png",
  "iqosilumaionekitmidnightblack":"assets/ean/iqos/iqos-ilumai-one-kit-midnight-black.png",
  "iqosilumaionekitvividterracotta":"assets/ean/iqos/iqos-ilumai-one-kit-vivid-terracotta.png",
  "iqosilumakitpebblebeige":"assets/ean/iqos/iqos-iluma-kit-pebble-beige.png",
  "iqosilumakitpebblegrey":"assets/ean/iqos/iqos-iluma-kit-pebble-grey.png",
  "lmbluelabelop2xlbox":"assets/ean/lm/l-m-blue-label-op-2xl-box.png",
  "lmbluelabelopbox":"assets/ean/lm/l-m-blue-label-op-box.png",
  "lmbluelabelopxlbox":"assets/ean/lm/l-m-blue-label-op-xl-box.png",
  "lmcigarettetobaccored":"assets/ean/lm/l-m-cigarette-tobacco-red.png",
  "lmcigarettetobaccoredpouch30g":"assets/ean/lm/LM Cigarette Tobacco Red Pouch 30g Gebinde.png",
  "lmcigarettetobaccoredpouch30ggebinde":"assets/ean/lm/LM Cigarette Tobacco Red Pouch 30g Gebinde.png",
  "lmfiltercigarillosbluelabelopbox":"assets/ean/lm/l-m-filter-cigarillos-blue-label-op-box.png",
  "lmfiltercigarillosbluelabelopboxpack17stk":"assets/ean/lm/LM Filter Cigarillos Blue Label OP Box Pack 17 Stk Gebinde.png",
  "lmfiltercigarillosbluelabelopboxpack17stkgebinde":"assets/ean/lm/LM Filter Cigarillos Blue Label OP Box Pack 17 Stk Gebinde.png",
  "lmfiltercigarillosredlabelopbox":"assets/ean/lm/l-m-filter-cigarillos-redlabel-op-box.png",
  "lmfiltercigarillosredlabelopboxpack17stk":"assets/ean/lm/LM Filter Cigarillos Red Label OP Box Pack 17 Stk Gebinde.png",
  "lmfiltercigarillosredlabelopboxpack17stkgebinde":"assets/ean/lm/LM Filter Cigarillos Red Label OP Box Pack 17 Stk Gebinde.png",
  "lmredlabelop2xlbox":"assets/ean/lm/l-m-red-label-op-2xl-box.png",
  "lmredlabelop4xlbox":"assets/ean/lm/l-m-red-label-op-4xl-box.png",
  "lmredlabelop7xlbox":"assets/ean/lm/l-m-red-label-op-7xl-box.png",
  "lmredlabelop9xlbox":"assets/ean/lm/l-m-red-label-op-9xl-box.png",
  "lmredlabelopbox":"assets/ean/lm/l-m-red-label-op-box.png",
  "lmredlabelopxlbox":"assets/ean/lm/l-m-red-label-op-xl-box.png",
  "lmvolumetobaccobluedose39gm":"assets/ean/lm/LM Volume Tobacco Blue Dose 39g M Gebinde.png",
  "lmvolumetobaccobluedose39gmgebinde":"assets/ean/lm/LM Volume Tobacco Blue Dose 39g M Gebinde.png",
  "lmvolumetobaccobluem":"assets/ean/lm/l-m-volume-tobacco-blue-m.png",
  "lmvolumetobaccored":"assets/ean/lm/l-m-volume-tobacco-red.png",
  "lmvolumetobaccoredbeutel85g":"assets/ean/lm/LM Volume Tobacco Red Beutel 85g.png",
  "lmvolumetobaccoredbig":"assets/ean/lm/l-m-volume-tobacco-red-big.png",
  "lmvolumetobaccoredbox129gbig":"assets/ean/lm/LM Volume Tobacco Red Box 129g Big.png",
  "lmvolumetobaccoredbox185gmega":"assets/ean/lm/LM Volume Tobacco Red Box 185g Mega.png",
  "lmvolumetobaccoreddose39gm":"assets/ean/lm/LM Volume Tobacco Red Dose 39g M Gebinde.png",
  "lmvolumetobaccoreddose39gmgebinde":"assets/ean/lm/LM Volume Tobacco Red Dose 39g M Gebinde.png",
  "lmvolumetobaccoreddose65gl":"assets/ean/lm/LM Volume Tobacco Red Dose 65g L Gebinde.png",
  "lmvolumetobaccoreddose65glgebinde":"assets/ean/lm/LM Volume Tobacco Red Dose 65g L Gebinde.png",
  "lmvolumetobaccoredl":"assets/ean/lm/l-m-volume-tobacco-red-l.png",
  "lmvolumetobaccoredm":"assets/ean/lm/l-m-volume-tobacco-red-m.png",
  "lmvolumetobaccoredmega":"assets/ean/lm/l-m-volume-tobacco-red-mega.png",
  "lmzigarettenbluelabel10x20er":"assets/ean/lm/L&M Zigaretten Blue Label (10x20er).png",
  "lmzigarettenbluelabel5x39er":"assets/ean/lm/L&M Zigaretten Blue Label (5x39er).png",
  "lmzigarettenbluelabel6x39er":"assets/ean/lm/L&M Zigaretten Blue Label (6x39er).png",
  "lmzigarettenbluelabel8x20er":"assets/ean/lm/L&M Zigaretten Blue Label (8x20er).png",
  "lmzigarettenbluelabel8x25er":"assets/ean/lm/L&M Zigaretten Blue Label (8x25er).png",
  "lmzigarettenbluelabel8x31er":"assets/ean/lm/L&M Zigaretten Blue Label (8x31er).png",
  "lmzigarettenredlabel3x60er":"assets/ean/lm/L&M Zigaretten Red Label (3x60er).png",
  "lmzigarettenredlabel8x25er":"assets/ean/lm/L&M Zigaretten Red Label (8x25er).png",
  "lmzigarettenredlabel8x31er":"assets/ean/lm/L&M Zigaretten Red Label (8x31er).png",
  "lmzigarettenredlabellong10x20er":"assets/ean/lm/L&M Zigaretten Red Label Long (10x20er).png",
  "lmzigarettensimplyblue10x20er":"assets/ean/lm/L&M Zigaretten Simply Blue (10x20er).png",
  "marlborocraftedbox230gmega":"assets/ean/marlboro_tabak/Marlboro Crafted Box 230g Mega.png",
  "marlborocraftedgoldop2xlbox":"assets/ean/marlboro/marlboro-crafted-gold-op-2xl-box.png",
  "marlborocraftedgoldop7xlbox":"assets/ean/marlboro/marlboro-crafted-gold-op-7xl-box.png",
  "marlborocraftedgoldopbox":"assets/ean/marlboro/marlboro-crafted-gold-op-box.png",
  "marlborocraftedredop2xlbox":"assets/ean/marlboro/marlboro-crafted-red-op-2xl-box.png",
  "marlborocraftedredop7xlbox":"assets/ean/marlboro/marlboro-crafted-red-op-7xl-box.png",
  "marlborocraftedredopbox":"assets/ean/marlboro/marlboro-crafted-red-op-box.png",
  "marlborogoldop2xlbox":"assets/ean/marlboro/marlboro-gold-op-2xl-box.png",
  "marlborogoldop4xlbox":"assets/ean/marlboro/marlboro-gold-op-4xl-box.png",
  "marlborogoldop7xlbox":"assets/ean/marlboro/marlboro-gold-op-7xl-box.png",
  "marlborogoldopbox":"assets/ean/marlboro/marlboro-gold-op-box.png",
  "marlborogoldopxlbox":"assets/ean/marlboro/marlboro-gold-op-xl-box.png",
  "marlborogoldsoftlabelopsoft":"assets/ean/marlboro/marlboro-gold-soft-label-op-soft.png",
  "marlboromixop2xlbox":"assets/ean/marlboro/marlboro-mix-op-2xl-box.png",
  "marlboromixopbox":"assets/ean/marlboro/marlboro-mix-op-box.png",
  "marlboromixopxlbox":"assets/ean/marlboro/marlboro-mix-op-xl-box.png",
  "marlboropremiumtobaccogold":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-gold.png",
  "marlboropremiumtobaccogolddose70gm":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Gold Dose 70g M Gebinde.png",
  "marlboropremiumtobaccogolddose70gmgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Gold Dose 70g M Gebinde.png",
  "marlboropremiumtobaccogoldm":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-gold-m.png",
  "marlboropremiumtobaccogoldpouch30g":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Gold Pouch 30g Gebinde.png",
  "marlboropremiumtobaccogoldpouch30ggebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Gold Pouch 30g Gebinde.png",
  "marlboropremiumtobaccored":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red.png",
  "marlboropremiumtobaccoreddose103gl":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 103g L Gebinde.png",
  "marlboropremiumtobaccoreddose103glgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 103g L Gebinde.png",
  "marlboropremiumtobaccoreddose155gxl":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 155g XL Gebinde.png",
  "marlboropremiumtobaccoreddose155gxlgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 155g XL Gebinde.png",
  "marlboropremiumtobaccoreddose70gm":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 70g M Gebinde.png",
  "marlboropremiumtobaccoreddose70gmgebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Dose 70g M Gebinde.png",
  "marlboropremiumtobaccoredl":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red-l.png",
  "marlboropremiumtobaccoredm":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-red-m.png",
  "marlboropremiumtobaccoredpouch30g":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Pouch 30g Gebinde.png",
  "marlboropremiumtobaccoredpouch30ggebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Red Pouch 30g Gebinde.png",
  "marlboropremiumtobaccoschwarzepouch50g":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Schwarze Pouch 50g Gebinde.png",
  "marlboropremiumtobaccoschwarzepouch50ggebinde":"assets/ean/marlboro_tabak/Marlboro Premium Tobacco Schwarze Pouch 50g Gebinde.png",
  "marlboropremiumtobaccozware":"assets/ean/marlboro_tabak/marlboro-premium-tobacco-zware.png",
  "marlbororedlongopbox":"assets/ean/marlboro/MARLBORO RED LONG OP-BOX.png",
  "marlbororedop2xlbox":"assets/ean/marlboro/marlboro-red-op-2xl-box.png",
  "marlbororedop4xlbox":"assets/ean/marlboro/marlboro-red-op-4xl-box.png",
  "marlbororedop7xlbox":"assets/ean/marlboro/marlboro-red-op-7xl-box.png",
  "marlbororedop9xlbox":"assets/ean/marlboro/MARLBORO RED OP 9XL-BOX.png",
  "marlbororedopbox":"assets/ean/marlboro/marlboro-red-op-box.png",
  "marlbororedopxlbox":"assets/ean/marlboro/MARLBORO RED OP XL-BOX.png",
  "marlbororedsoftlabelopsoft":"assets/ean/marlboro/marlboro-red-soft-label-op-soft.png",
  "marlborozigarettencraftedgold10x20er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Gold (10x20er).png",
  "marlborozigarettencraftedgold2xl8x27er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Gold 2XL (8x27er).png",
  "marlborozigarettencraftedgold60er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Gold (60er).png",
  "marlborozigarettencraftedred10x20er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Red (10x20er).png",
  "marlborozigarettencraftedred2xl8x27er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Red 2XL (8x27er).png",
  "marlborozigarettencraftedred60er":"assets/ean/marlboro/Marlboro Zigaretten Crafted Red (60er).png",
  "marlborozigarettengold10x20er":"assets/ean/marlboro/Marlboro Zigaretten Gold (10x20er).png",
  "marlborozigarettengold3x52er":"assets/ean/marlboro/Marlboro Zigaretten Gold (3x52er).png",
  "marlborozigarettengold5x39er":"assets/ean/marlboro/Marlboro Zigaretten Gold (5x39er).png",
  "marlborozigarettengold8x23er":"assets/ean/marlboro/Marlboro Zigaretten Gold (8x23er).png",
  "marlborozigarettengoldlong10x20er":"assets/ean/marlboro/Marlboro Zigaretten Gold Long (10x20er).png",
  "marlborozigarettengoldsoftlabel10x20er":"assets/ean/marlboro/Marlboro Zigaretten Gold Soft Label (10x20er).png",
  "marlborozigarettenred8x20er":"assets/ean/marlboro/Marlboro Zigaretten Red (8x20er).png",
  "marlborozigarettenred8x25er":"assets/ean/marlboro/Marlboro Zigaretten Red (8x25er).png",
  "marlborozigarettensilverblue10x20er":"assets/ean/marlboro/Marlboro Zigaretten Silver Blue (10x20er).png",
  "marlborozigarettensimplyblue10x20er":"assets/ean/marlboro/Marlboro Zigaretten Simply Blue (10x20er).png",
  "marlborozigarettensimplyred10x20er":"assets/ean/marlboro/Marlboro Zigaretten Simply Red (10x20er).png",
  "marlborozigarettenwhite10x20er":"assets/ean/marlboro/Marlboro Zigaretten White (10x20er).png",
  "marlborozigarettenwhite5x39er":"assets/ean/marlboro/Marlboro Zigaretten White (5x39er).png",
  "marlborozigarettenwhite8x25er":"assets/ean/marlboro/Marlboro Zigaretten White (8x25er).png",
  "marlborozigarettenwhite8x25er2":"assets/ean/marlboro/Marlboro Zigaretten White (8x25er) (2).png",
  "marlborozigarettenwhite8x31er":"assets/ean/marlboro/Marlboro Zigaretten White (8x31er).png",
  "parliamentzigarettennightblue10x20er":"assets/ean/other/Parliament Zigaretten Night Blue (10x20er).png",
  "pielrojarollingtobacco":"assets/ean/other/pielroja-rolling-tobacco.png",
  "pielrojarollingtobaccopouch30g":"assets/ean/other/Pielroja Rolling Tobacco Pouch 30g Gebinde.png",
  "pielrojarollingtobaccopouch30ggebinde":"assets/ean/other/Pielroja Rolling Tobacco Pouch 30g Gebinde.png",
  "tereaamberselection":"assets/ean/terea/terea-amber-selection.png",
  "tereabronzeselection":"assets/ean/terea/terea-bronze-selection.png",
  "terearussetselection":"assets/ean/terea/terea-russet-selection.png",
  "tereasiennaselection":"assets/ean/terea/terea-sienna-selection.png",
  "tereasilverselection":"assets/ean/terea/terea-silver-selection.png",
  "tereateakselection":"assets/ean/terea/terea-teak-selection.png",
  "tereaturquoiseselection":"assets/ean/terea/terea-turquoise-selection.png",
  "tereawarmfuseselection":"assets/ean/terea/terea-warm-fuse-selection.png",
  "tereayellowgreenselection":"assets/ean/terea/terea-yellow-green-selection.png",
  "tereayellowselection":"assets/ean/terea/terea-yellow-selection.png",
  "veevnowultrablueraspberry":"assets/ean/veev/veev-now-ultra-blue-raspberry.png",
  "veevnowultraclassicmint":"assets/ean/veev/veev-now-ultra-classic-mint.png",
  "veevnowultrafruitkiwiguavaveev":"assets/ean/veev/veev-now-ultra-fruit-kiwi-guava-veev.png",
  "veevnowultragrape":"assets/ean/veev/veev-now-ultra-grape.png",
  "veevnowultramango":"assets/ean/veev/veev-now-ultra-mango.png",
  "veevnowultrasourapple":"assets/ean/veev/veev-now-ultra-sour-apple.png",
  "veevnowultrastrawberry":"assets/ean/veev/veev-now-ultra-strawberry.png",
  "veevnowultrawatermelon":"assets/ean/veev/veev-now-ultra-watermelon.png",
  "veevonekitfreshygreen":"assets/ean/veev/veev-one-kit-freshy-green.png",
  "veevonekitsilkygrey":"assets/ean/veev/veev-one-kit-silky-grey.png",
  "veevonekitvelvetblack":"assets/ean/veev/veev-one-kit-velvet-black.png",
  "veevonepodsbalancedtobacco":"assets/ean/veev/veev-one-pods-balanced-tobacco.png",
  "veevonepodsblueberry":"assets/ean/veev/veev-one-pods-blueberry.png",
  "veevonepodsbluemint":"assets/ean/veev/veev-one-pods-blue-mint.png",
  "veevonepodsblueraspberry":"assets/ean/veev/veev-one-pods-blue-raspberry.png",
  "veevonepodscherry":"assets/ean/veev/veev-one-pods-cherry.png",
  "veevonepodsclassictobacco":"assets/ean/veev/veev-one-pods-classic-tobacco.png",
  "veevonepodsgrape":"assets/ean/veev/veev-one-pods-grape.png",
  "veevonepodsgreenmint":"assets/ean/veev/veev-one-pods-green-mint.png",
  "veevonepodsicemint":"assets/ean/veev/veev-one-pods-ice-mint.png",
  "veevonepodsmango":"assets/ean/veev/veev-one-pods-mango.png",
  "veevonepodspassionfruitkiwiguava":"assets/ean/veev/veev-one-pods-passion-fruit-kiwi-guava.png",
  "veevonepodspeach":"assets/ean/veev/veev-one-pods-peach.png",
  "veevonepodssourapple":"assets/ean/veev/veev-one-pods-sour-apple.png",
  "veevonepodsstrawberry":"assets/ean/veev/veev-one-pods-strawberry.png",
  "veevonepodswatermelon":"assets/ean/veev/veev-one-pods-watermelon.png"
};
function nKey(s){
  return (s||"").toLowerCase().replace(/[^a-z0-9]+/g,"");
}
function eanSrc(p){
  if(!p) return "";
  const brand = nKey(p.brand);
  const name = nKey(p.name);
  const content = nKey(p.content);
  const candidates = [
    brand+name+content,
    name+content,
    brand+name,
    name
  ].filter(Boolean);

  for(const c of candidates){
    if(EAN_FILE_MAP[c]) return EAN_FILE_MAP[c];
    const c2 = c.replace(/gebinde/g,"");
    if(EAN_FILE_MAP[c2]) return EAN_FILE_MAP[c2];
  }

  // Fuzzy fallback: best score by containment
  let bestPath = "";
  let bestScore = 0;
  for(const [k,path] of Object.entries(EAN_FILE_MAP)){
    let score = 0;
    if(name && k.includes(name)) score += 100 + name.length;
    if(brand && k.includes(brand)) score += 50 + brand.length;
    if(content && k.includes(content)) score += 20 + content.length;
    if(score > bestScore){
      bestScore = score;
      bestPath = path;
    }
  }
  return bestScore >= 100 ? bestPath : "";
}


    



  function fillTable(){
    const tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";
    const only = !!onlyMissing.checked;

    data.forEach((p,idx)=>{
      const st = answers[idx].status;
      if(only && st !== false) return;

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.section}</td>
        <td><b>${p.brand}</b><br>${p.name}</td>
        <td>${euro(p.price)}</td>
        <td>${(p.content && String(p.content).trim()) ? p.content : "‚Äî"}</td>
        <td class="${st===true?'statusOk':(st===false?'statusNo':'')}">${st===true?'DA':(st===false?'NICHT DA':'OFFEN')}</td>
        <td class="action-col">
          ${st===false ? '<button class="rowBtn ok" data-action="set-true" data-idx="'+idx+'">‚úÖ jetzt DA</button>' : ''}
          ${st===true ? '<button class="rowBtn no" data-action="set-false" data-idx="'+idx+'">‚ùå doch NICHT</button>' : ''}
        </td>
        <td class="ean-col">
          <img class="ean-img" src="${eanSrc(p)}" alt="EAN" onerror="this.outerHTML='‚Äî'">
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  function showSummary(){
    card.style.display="none";
    footerBar.style.display="none";
    summary.style.display="block";
    fillTable();
  }

  function resetAll(){
    answers = data.map(_ => ({status:null}));
    localStorage.setItem(KEY, JSON.stringify(answers));
    i = 0;
    summary.style.display="none";
    card.style.display="block";
    footerBar.style.display="block";
    showProduct();
  }

  // Export-Tabelle: Status nachtr√§glich √§ndern
  resultTable.addEventListener("click", (e)=>{
    const btn = e.target.closest("button.rowBtn");
    if(!btn) return;
    const idx = Number(btn.getAttribute("data-idx"));
    const action = btn.getAttribute("data-action");
    if(!Number.isFinite(idx)) return;

    if(action === "set-true") answers[idx].status = true;
    if(action === "set-false") answers[idx].status = false;

    localStorage.setItem(KEY, JSON.stringify(answers));

    // Wenn Filter aktiv ist und du auf DA setzt, verschwindet die Zeile ‚Äì wir zeigen deshalb eine kurze Meldung.
    if(action === "set-true" && onlyMissing.checked) {
      showToast("‚úÖ Auf ‚ÄûDA‚Äú gesetzt (durch Filter ausgeblendet).");
    } else if(action === "set-false") {
      showToast("‚ùå Auf ‚ÄûNICHT DA‚Äú gesetzt.");
    }

    fillTable();
    updateHeader();
  });

  btnOk.addEventListener("click", ()=>mark(true));
  btnNo.addEventListener("click", ()=>mark(false));
  if(elJump){
    elJump.addEventListener("change", ()=>{
      const cat = String(elJump.value || "");
      if(!cat) return;
      jumpToCategory(cat);
    });
  }
  // Unten rechts: jederzeit in die Export-Ansicht springen (auch wenn noch nicht alles beantwortet ist)
  btnExport.addEventListener("click", ()=>{ showSummary(); });

  btnBack.addEventListener("click", ()=>{
    summary.style.display="none";
    card.style.display="block";
    footerBar.style.display="block";
    const firstOpen2 = answers.findIndex(a => a.status === null);
    if(firstOpen2 === -1){
      // alles beantwortet: gehe zum letzten Produkt (sonst springt man sofort wieder in die Ergebnis-Ansicht)
      let last = -1;
      for(let k=0;k<answers.length;k++){ if(answers[k].status !== null) last = k; }
      i = last === -1 ? 0 : last;
    } else {
      i = firstOpen2;
    }
    updateHeader();
    showProduct();
  });

  btnReset.addEventListener("click", resetAll);
  onlyMissing.addEventListener("change", fillTable);

  btnPrint.addEventListener("click", ()=>{
    fillTable();
    window.print();
  });

  // E-Mail (Outlook/Standard-Mail) ‚Äì technisch kann ein Browser keine lokale PDF automatisch anh√§ngen.
  // Daher: PDF-Dialog √∂ffnen + direkt eine Mail mit Betreff/Text vorbereiten.
  // Auf Mobile (Outlook App) ist ‚ÄûTeilen‚Äú mit Anhang m√∂glich ‚Äì das bauen wir gern als n√§chstes ein.

  window.addEventListener("keydown", (e)=>{
    if(summary.style.display === "block") return;
    if(e.key === "ArrowLeft") mark(false);
    if(e.key === "ArrowRight") mark(true);
    if(e.key === "ArrowDown"){ i++; showProduct(); }
  });

  const firstOpen = answers.findIndex(a => a.status === null);
  i = firstOpen === -1 ? data.length : firstOpen;

  buildJumpOptions();
  updateHeader();
  showProduct();
</script>

<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    });
  }
</script>

</body>
</html>
